<!DOCTYPE html>

<!-- HOMEPAGE STRUCTURE -->
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Homepage</title>
    <link rel="stylesheet" type="text/css" th:href="@{/css/styles.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/layout.css}">
    <link rel="stylesheet" type="text/css" th:href="@{/css/pets.css}"> <!-- Include pets.css for styling -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
    <link rel="icon" type="image/png" th:href="@{/favicon.png}">
</head>
<body>
    <div th:insert="~{fragments/header :: header}"></div> <!-- header fragment to display -->
    
    <div class="container">
        <div class="profiles"> <!-- Region for Pet Profile Tiles -->

            <div class="search-profiles"> <!-- Search bar -->
                <form action="#"> <!-- implemented Search bar -->
                    <input type="text" placeholder="Search Profiles" name="search">
                    <button>
                        <i class="fas fa-search"></i>
                    </button>
                </form>
            </div>

            <!-- Pet profile cards section -->
            <div class="pet-cards-container">
                <div th:each="pet : ${pets}" class="pet-card" th:data-pet-id="${pet.petId}">
                    <img th:src="@{/petImage/{petId}(petId=${pet.petId})}" alt="Pet Image" class="pet-image">
                    <h3 th:text="${pet.name}">Pet Name</h3>
                    <p th:text="'Adoption Status: ' + ${pet.adoptionStatus}">Adoption Status</p>
                    <p th:text="'Fee: $' + ${pet.fee}">Fee</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Include pet modal fragment -->
    <div th:insert="~{pets :: petModal}"></div>
    <div th:insert="~{pets :: petModalScripts}"></div>

    <!-- JavaScript functions -->
    <script th:inline="javascript">
        /*<![CDATA[*/
        document.addEventListener('DOMContentLoaded', function() {
            const petCards = document.querySelectorAll('.pet-card');
            petCards.forEach(card => {
                card.addEventListener('click', function() {
                    const petId = this.getAttribute('data-pet-id');
                    openPetModal(petId);
                });
            });
        });

        function openPetModal(petId) {
            console.log("openPetModal function is loaded");
            fetch(`/pet/${petId}`)
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Network response was not ok');
                    }
                    return response.json();
                })
                .then(pet => {
                    document.getElementById('modalPetName').innerHTML = pet.name;
                    document.getElementById('modalPetImage').src = pet.photoUrl;
                    document.getElementById('modalPetAdoptionStatus').innerHTML = 'Adoption Status: <span class="modal-value">' + pet.adoptionStatus + '</span>';
                    document.getElementById('modalPetFee').innerHTML = 'Fee: <span class="modal-value">$' + pet.fee + '</span>';
                    document.getElementById('modalPetType').innerHTML = 'Type: <span class="modal-value">' + pet.type + '</span>';
                    document.getElementById('modalPetBreed1').innerHTML = 'Breed 1: <span class="modal-value">' + pet.breed1 + '</span>';
                    if (pet.breed2) {
                        document.getElementById('modalPetBreed2').innerHTML = 'Breed 2: <span class="modal-value">' + pet.breed2 + '</span>';
                        document.getElementById('modalPetBreed2').style.display = 'block';
                    } else {
                        document.getElementById('modalPetBreed2').style.display = 'none';
                    }
                    document.getElementById('modalPetColor1').innerHTML = 'Color 1: <span class="modal-value">' + pet.color1 + '</span>';
                    if (pet.color2) {
                        document.getElementById('modalPetColor2').innerHTML = 'Color 2: <span class="modal-value">' + pet.color2 + '</span>';
                        document.getElementById('modalPetColor2').style.display = 'block';
                    } else {
                        document.getElementById('modalPetColor2').style.display = 'none';
                    }
                    if (pet.color3) {
                        document.getElementById('modalPetColor3').innerHTML = 'Color 3: <span class="modal-value">' + pet.color3 + '</span>';
                        document.getElementById('modalPetColor3').style.display = 'block';
                    } else {
                        document.getElementById('modalPetColor3').style.display = 'none';
                    }
                    document.getElementById('modalPetLocation').innerHTML = 'Location: <span class="modal-value">' + pet.location + '</span>';
                    document.getElementById('modalPetMaturitySize').innerHTML = 'Maturity Size: <span class="modal-value">' + pet.maturitySize + '</span>';
                    document.getElementById('modalPetAge').innerHTML = 'Age: <span class="modal-value">' + pet.age + ' months</span>';
                    document.getElementById('modalPetGender').innerHTML = 'Gender: <span class="modal-value">' + pet.gender + '</span>';
                    document.getElementById('modalPetHealthStatus').innerHTML = 'Health Status: <span class="modal-value">' + pet.healthStatus + '</span>';
                    document.getElementById('modalPetVaccinationStatus').innerHTML = 'Vaccination Status: <span class="modal-value">' + pet.vaccinationStatus + '</span>';
                    document.getElementById('modalPetSterilized').innerHTML = 'Sterilized: <span class="modal-value">' + pet.sterilized + '</span>';
                    document.getElementById('modalPetDewormed').innerHTML = 'Dewormed: <span class="modal-value">' + pet.dewormed + '</span>';
                    document.getElementById('modalPetFurLength').innerHTML = 'Fur Length: <span class="modal-value">' + pet.furLength + '</span>';
                    document.getElementById('modalPetDescription').innerHTML = 'Description: <span class="modal-value">' + pet.description + '</span>';
                    document.getElementById('petModal').style.display = 'block';
                })
                .catch(error => {
                    console.error('Error fetching pet details:', error);
                });
        }
        /*]]>*/
    </script>
</body>
<!-- TODO: create favorites modal (popup on main page on click of icon) -->
</html>