<!DOCTYPE html>
<!-- Rescuer Dashboard -->
<html xmlns:th="http://www.thymeleaf.org">
    <head>
        <title>Rescuer Dashboard</title>
        <link rel="stylesheet" type="text/css" th:href="@{/css/dashboard.css}">
        <link rel="stylesheet" type="text/css" th:href="@{/css/layout.css}">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.2/css/all.min.css" />
        <link rel="icon" type="image/png" th:href="@{/favicon.png}">
    </head>
    <body>
        <div th:insert="~{fragments/header :: header}"></div> <!-- header fragment to display -->
        <h1>Rescuer Dashboard</h1>
        
        <div class="container">
            <div class="profile-card">
                <p id="rescuer-Id" th:text="'Rescuer ID: ' + ${rescuerId}">Rescuer ID</p>
                <img id="profileImage" th:src="${profileImage}" alt="Profile Image">
                <button type="button" class="clear-profile-button-resc" onclick="clearImage()" style="display: none;">X</button>
                <h2 id="profileUsername" th:text="${user.username}">John Doe</h2>
                <p th:text="${user.email}">john.doe@example.com</p>
                <button id="editButton" onclick="enableEdit()">Edit</button>
                
                <div id="editForm" style="display: none;">
                    <form method="post" enctype="multipart/form-data" action="/updateProfile">
                        <div>
                            <label>Username:</label>
                            <input type="text" id="username" name="username" th:value="${user.username}" oninput="updateUsername()">
                        </div>
                        <div>
                            <label>Profile Image:</label>
                            <input type="file" id="fileInput" name="file" accept="image/*" onchange="loadFile(event)" style="display: none;">
                            <button type="button" class="custom-file-button" onclick="document.getElementById('fileInput').click();">
                                <i class="fas fa-upload"></i> Choose File
                            </button>
                            <input type="hidden" id="clearImageFlag" name="clearImageFlag" value="false">
                        </div>
                        <input type="hidden" name="userId" th:value="${user.userId}">
                        <button type="submit" class="save-changes-button" style="margin-left: 0;">Save Changes</button>
                    </form>
                </div>
            </div>
        </div>

        <!--
        <div class="pet-cards">
            <div th:each="pet : ${pets}" class="pet-card">
                <h3 th:text="${pet.name}">Pet Name</h3>
                <p th:text="'Breed: ' + ${pet.breed}">Breed</p>
                <p th:text="'Type: ' + ${pet.type}">Type</p>
                <p th:text="'Age: ' + ${pet.age} + ' years'">Age</p>
            </div>
        </div>
        -->

        <div th:if="${errorMessage}" class="error-message">
            <p th:text="${errorMessage}"></p>
        </div>

        <script>
            function enableEdit() {
                document.getElementById('editForm').style.display = 'block';
                document.getElementById('editButton').style.display = 'none';
                document.querySelector('.clear-profile-button-resc').style.display = 'block';
            }

            function loadFile(event) {
                var image = document.getElementById('profileImage');
                image.src = URL.createObjectURL(event.target.files[0]);
                document.getElementById('clearImageFlag').value = 'false';
            }

            function clearImage() {
                var image = document.getElementById('profileImage');
                image.src = '/images/profile-placeholder.png';
                document.getElementById('fileInput').value = '';
                document.getElementById('clearImageFlag').value = 'true';
            }

            function updateUsername() { // as user types, updates the username in the profile card
                var usernameInput = document.getElementById('username');
                var profileUsername = document.getElementById('profileUsername');
                profileUsername.textContent = usernameInput.value;
            }
        </script>
    </body>
</html>